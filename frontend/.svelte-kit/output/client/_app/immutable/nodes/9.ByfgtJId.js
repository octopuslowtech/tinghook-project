import{c as we,a as b,f as k}from"../chunks/BIHYj5q8.js";import{o as Ue}from"../chunks/C1N3qTNx.js";import{f as be,p as Fe,q as p,a3 as w,w as s,c as r,r as t,s as o,k as e,t as pe,v as ae,o as Me}from"../chunks/CNB1M18W.js";import{s as L}from"../chunks/YAzIAqS4.js";import{i as B}from"../chunks/Ny0y5trL.js";import{I as Ne,s as De,e as he,i as ye}from"../chunks/AC_Dnq90.js";import{a as H,r as ve,b as xe,c as We}from"../chunks/DtRFns2F.js";import{d as Ee,e as je}from"../chunks/BovVG3Uo.js";import{b as fe}from"../chunks/Du-1FX4s.js";import{X as qe,P as ze,a as Ie,T as Ae}from"../chunks/MMhnirwg.js";import{B as Ce}from"../chunks/DxAib77k.js";import{M as Be}from"../chunks/Xd4_TOE2.js";import"../chunks/BO5QB-9v.js";import{l as Oe,s as He}from"../chunks/u9c0W3Mj.js";function Ge(C,i){const v=Oe(i,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.460.1 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6"}],["circle",{cx:"8",cy:"12",r:"2"}]];Ne(C,He({name:"toggle-left"},()=>v,{get iconNode(){return g},children:(u,_)=>{var m=we(),y=be(m);De(y,i,"default",{}),b(u,m)},$$slots:{default:!0}}))}function Xe(C,i){const v=Oe(i,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.460.1 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6"}],["circle",{cx:"16",cy:"12",r:"2"}]];Ne(C,He({name:"toggle-right"},()=>v,{get iconNode(){return g},children:(u,_)=>{var m=we(),y=be(m);De(y,i,"default",{}),b(u,m)},$$slots:{default:!0}}))}var Je=k('<div class="mb-4 rounded bg-red-50 p-3 text-sm text-red-600"> </div>'),Ke=k("<option> </option>"),Qe=k('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50" role="dialog" aria-modal="true" tabindex="-1"><div class="w-full max-w-lg rounded-lg bg-white shadow-xl"><div class="flex items-center justify-between border-b px-6 py-4"><h2 class="text-lg font-semibold"> </h2> <button class="rounded p-1 hover:bg-gray-100"><!></button></div> <form class="p-6"><!> <div class="space-y-4"><div><label for="trigger_type" class="mb-1 block text-sm font-medium text-gray-700">Trigger Type</label> <select id="trigger_type" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"><option>SMS</option><option>Notification</option></select></div> <div><label for="device_id" class="mb-1 block text-sm font-medium text-gray-700">Device (Optional)</label> <select id="device_id" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"><option>All Devices</option><!></select></div> <div><label for="sender_filter" class="mb-1 block text-sm font-medium text-gray-700">Sender Filter</label> <input id="sender_filter" type="text" placeholder="e.g., +1234567890 or regex pattern" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"/> <p class="mt-1 text-xs text-gray-500">Leave empty to match all senders</p></div> <div><label for="content_filter" class="mb-1 block text-sm font-medium text-gray-700">Content Filter</label> <input id="content_filter" type="text" placeholder="e.g., OTP or regex pattern" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"/> <p class="mt-1 text-xs text-gray-500">Leave empty to match all messages</p></div> <div><label for="webhook_url" class="mb-1 block text-sm font-medium text-gray-700">Webhook URL <span class="text-red-500">*</span></label> <input id="webhook_url" type="url" placeholder="https://example.com/webhook" required class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"/></div> <div><label for="method" class="mb-1 block text-sm font-medium text-gray-700">HTTP Method</label> <select id="method" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"><option>GET</option><option>POST</option><option>PUT</option></select></div> <div><label for="secret_header" class="mb-1 block text-sm font-medium text-gray-700">Secret Header (Optional)</label> <input id="secret_header" type="text" placeholder="X-Webhook-Secret: your-secret" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"/> <p class="mt-1 text-xs text-gray-500">Custom header for webhook authentication</p></div></div> <div class="mt-6 flex justify-end gap-3"><button type="button" class="rounded-lg border border-gray-300 px-4 py-2 hover:bg-gray-50">Cancel</button> <button type="submit" class="rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50"> </button></div></form></div></div>');function Ve(C,i){var A,ue,d,ke,Te,Re,Se;Fe(i,!0);let v=p(w([])),g=p(!1),u=p(""),_=p(w(((A=i.rule)==null?void 0:A.trigger_type)||"sms")),m=p(w(((ue=i.rule)==null?void 0:ue.device_id)||"")),y=p(w(((d=i.rule)==null?void 0:d.sender_filter)||"")),G=p(w(((ke=i.rule)==null?void 0:ke.content_filter)||"")),U=p(w(((Te=i.rule)==null?void 0:Te.webhook_url)||"")),W=p(w(((Re=i.rule)==null?void 0:Re.method)||"POST")),F=p(w(((Se=i.rule)==null?void 0:Se.secret_header)||""));Ue(async()=>{try{s(v,await H.getDevices(),!0)}catch{s(v,[],!0)}});function X(a){try{const n=new URL(a);return n.protocol==="http:"||n.protocol==="https:"}catch{return!1}}async function ge(a){if(a.preventDefault(),s(u,""),!e(U).trim()){s(u,"Webhook URL is required");return}if(!X(e(U))){s(u,"Please enter a valid HTTP/HTTPS URL");return}s(g,!0);try{await i.onSave({device_id:e(m)||null,trigger_type:e(_),sender_filter:e(y),content_filter:e(G),webhook_url:e(U),method:e(W),secret_header:e(F)||void 0})}catch(n){s(u,n instanceof Error?n.message:"Failed to save rule",!0)}finally{s(g,!1)}}var T=Qe();T.__click=a=>a.target===a.currentTarget&&i.onClose(),T.__keydown=a=>a.key==="Escape"&&i.onClose();var oe=r(T),J=r(oe),K=r(J),_e=r(K,!0);t(K);var l=o(K,2);l.__click=function(...a){var n;(n=i.onClose)==null||n.apply(this,a)};var c=r(l);qe(c,{class:"h-5 w-5"}),t(l),t(J);var M=o(J,2),Q=r(M);{var V=a=>{var n=Je(),O=r(n,!0);t(n),pe(()=>L(O,e(u))),b(a,n)};B(Q,a=>{e(u)&&a(V)})}var h=o(Q,2),x=r(h),R=o(r(x),2),j=r(R);j.value=j.__value="sms";var le=o(j);le.value=le.__value="notification",t(R),t(x);var f=o(x,2),N=o(r(f),2),D=r(N);D.value=D.__value="";var se=o(D);he(se,17,()=>e(v),ye,(a,n)=>{var O=Ke(),Le=r(O,!0);t(O);var Pe={};pe(()=>{L(Le,e(n).name),Pe!==(Pe=e(n).id)&&(O.value=(O.__value=e(n).id)??"")}),b(a,O)}),t(N),t(f);var q=o(f,2),ie=o(r(q),2);ve(ie),ae(2),t(q);var Y=o(q,2),Z=o(r(Y),2);ve(Z),ae(2),t(Y);var $=o(Y,2),z=o(r($),2);ve(z),t($);var ee=o($,2),S=o(r(ee),2),te=r(S);te.value=te.__value="GET";var E=o(te);E.value=E.__value="POST";var I=o(E);I.value=I.__value="PUT",t(S),t(ee);var ne=o(ee,2),de=o(r(ne),2);ve(de),ae(2),t(ne),t(h);var ce=o(h,2),re=r(ce);re.__click=function(...a){var n;(n=i.onClose)==null||n.apply(this,a)};var P=o(re,2),me=r(P,!0);t(P),t(ce),t(M),t(oe),t(T),pe(()=>{L(_e,i.rule?"Edit Rule":"Create Rule"),P.disabled=e(g),L(me,e(g)?"Saving...":i.rule?"Update Rule":"Create Rule")}),je("submit",M,ge),xe(R,()=>e(_),a=>s(_,a)),xe(N,()=>e(m),a=>s(m,a)),fe(ie,()=>e(y),a=>s(y,a)),fe(Z,()=>e(G),a=>s(G,a)),fe(z,()=>e(U),a=>s(U,a)),xe(S,()=>e(W),a=>s(W,a)),fe(de,()=>e(F),a=>s(F,a)),b(C,T),Me()}Ee(["click","keydown"]);var Ye=k('<div class="h-16 animate-pulse rounded-lg bg-gray-200"></div>'),Ze=k('<div class="space-y-4"></div>'),$e=k('<div class="rounded-lg bg-white p-12 text-center shadow"><!> <h3 class="mb-2 text-lg font-semibold">No forwarding rules</h3> <p class="text-gray-500">Create rules to forward SMS and notifications to webhooks.</p></div>'),et=k('<tr class="hover:bg-gray-50"><td class="px-6 py-4"><span class="flex items-center gap-2"><!> <span class="capitalize"> </span></span></td><td class="px-6 py-4 text-sm text-gray-600"> </td><td class="px-6 py-4 font-mono text-sm text-gray-600"> </td><td class="px-6 py-4"><button class="focus:outline-none"><!></button></td><td class="px-6 py-4 text-right"><button class="rounded p-2 hover:bg-gray-100" title="Edit"><!></button> <button class="rounded p-2 text-red-500 hover:bg-gray-100" title="Delete"><!></button></td></tr>'),tt=k('<div class="overflow-hidden rounded-lg bg-white shadow"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium uppercase text-gray-500">Type</th><th class="px-6 py-3 text-left text-xs font-medium uppercase text-gray-500">Filter</th><th class="px-6 py-3 text-left text-xs font-medium uppercase text-gray-500">Webhook</th><th class="px-6 py-3 text-left text-xs font-medium uppercase text-gray-500">Status</th><th class="px-6 py-3 text-right text-xs font-medium uppercase text-gray-500">Actions</th></tr></thead><tbody class="divide-y"></tbody></table></div>'),rt=k('<div class="mb-6 flex items-center justify-between"><h1 class="text-2xl font-bold">Forwarding Rules</h1> <button class="flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700"><!> Create Rule</button></div> <!> <!>',1);function _t(C,i){Fe(i,!0);let v=p(w([])),g=p(!0),u=p(!1),_=p(null);Ue(async()=>{try{s(v,await H.getRules(),!0)}catch{s(v,[],!0)}s(g,!1)});async function m(l){try{await H.updateRule(l.id,{is_active:!l.is_active}),l.is_active=!l.is_active}catch(c){console.error("Failed to toggle rule:",c)}}async function y(l){if(confirm("Delete this rule?"))try{await H.deleteRule(l),s(v,e(v).filter(c=>c.id!==l),!0)}catch(c){console.error("Failed to delete rule:",c)}}async function G(l){e(_)?await H.updateRule(e(_).id,l):await H.createRule(l),s(v,await H.getRules(),!0),s(u,!1)}function U(l,c=40){return l.length<=c?l:l.substring(0,c)+"..."}var W=rt(),F=be(W),X=o(r(F),2);X.__click=()=>{s(_,null),s(u,!0)};var ge=r(X);ze(ge,{class:"h-4 w-4"}),ae(),t(X),t(F);var T=o(F,2);{var oe=l=>{var c=Ze();he(c,20,()=>[1,2,3],ye,(M,Q)=>{var V=Ye();b(M,V)}),t(c),b(l,c)},J=l=>{var c=we(),M=be(c);{var Q=h=>{var x=$e(),R=r(x);Ce(R,{class:"mx-auto mb-4 h-16 w-16 text-gray-400"}),ae(4),t(x),b(h,x)},V=h=>{var x=tt(),R=r(x),j=o(r(R));he(j,21,()=>e(v),ye,(le,f)=>{var N=et(),D=r(N),se=r(D),q=r(se);{var ie=d=>{Be(d,{class:"h-4 w-4 text-blue-500"})},Y=d=>{Ce(d,{class:"h-4 w-4 text-purple-500"})};B(q,d=>{e(f).trigger_type==="sms"?d(ie):d(Y,!1)})}var Z=o(q,2),$=r(Z,!0);t(Z),t(se),t(D);var z=o(D),ee=r(z,!0);t(z);var S=o(z),te=r(S,!0);t(S);var E=o(S),I=r(E);I.__click=()=>m(e(f));var ne=r(I);{var de=d=>{Xe(d,{class:"h-6 w-6 text-green-500"})},ce=d=>{Ge(d,{class:"h-6 w-6 text-gray-400"})};B(ne,d=>{e(f).is_active?d(de):d(ce,!1)})}t(I),t(E);var re=o(E),P=r(re);P.__click=()=>{s(_,e(f),!0),s(u,!0)};var me=r(P);Ie(me,{class:"h-4 w-4"}),t(P);var A=o(P,2);A.__click=()=>y(e(f).id);var ue=r(A);Ae(ue,{class:"h-4 w-4"}),t(A),t(re),t(N),pe(d=>{L($,e(f).trigger_type),L(ee,e(f).sender_filter||e(f).content_filter||"No filter"),We(S,"title",e(f).webhook_url),L(te,d)},[()=>U(e(f).webhook_url)]),b(le,N)}),t(j),t(R),t(x),b(h,x)};B(M,h=>{e(v).length===0?h(Q):h(V,!1)},!0)}b(l,c)};B(T,l=>{e(g)?l(oe):l(J,!1)})}var K=o(T,2);{var _e=l=>{Ve(l,{get rule(){return e(_)},onClose:()=>s(u,!1),onSave:G})};B(K,l=>{e(u)&&l(_e)})}b(C,W),Me()}Ee(["click"]);export{_t as component};
